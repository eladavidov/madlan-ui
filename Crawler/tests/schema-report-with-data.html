<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madlan Crawler Database Schema</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 40px; border-left: 4px solid #3498db; padding-left: 15px; }
        .stats { background: #ecf0f1; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .stats div { display: inline-block; margin-right: 30px; font-size: 16px; }
        .stats strong { color: #2980b9; font-size: 24px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; }
        th { background: #3498db; color: white; padding: 12px; text-align: left; font-weight: 600; }
        td { padding: 10px; border: 1px solid #ddd; }
        tr:nth-child(even) { background: #f9f9f9; }
        .table-comment { background: #e8f4f8; padding: 12px; border-left: 4px solid #3498db; margin: 10px 0; font-style: italic; color: #555; }
        .column-name { font-weight: 600; color: #2c3e50; }
        .column-type { color: #7f8c8d; font-size: 12px; }
        .sample-data { background: #fff3cd; padding: 8px; border-radius: 3px; font-family: monospace; font-size: 12px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; }
        .null-value { color: #999; font-style: italic; }
        .metadata { color: #7f8c8d; font-size: 12px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—„ï¸ Madlan Crawler Database Schema</h1>
        <p><strong>Database:</strong> DuckDB (properties.duckdb)</p>
        <p><strong>Target:</strong> Haifa Properties for Sale (~3,600 available)</p>
        <p><strong>Generated:</strong> 2025-10-11T08:31:39.279Z</p>

        <div class="stats">
            <div><strong>2</strong><br>Sample Properties</div>
            <div><strong>10</strong><br>Total Tables</div>
            <div><strong>80+</strong><br>Documented Columns</div>
            <div><strong>100%</strong><br>Current Success Rate</div>
        </div>

        <h2>ğŸ“Š Properties Table</h2>
        <div class="table-comment">
            Main table storing comprehensive property listings data from Madlan.co.il including basic info, amenities, location, and pricing details.
        </div>
        <table>
            <tr>
                <th style="width: 200px">Column</th>
                <th style="width: 400px">Description</th>
                <th>Sample Data</th>
            </tr>
            <tr>
                <td class="column-name">id</td>
                <td>Unique property identifier from Madlan URL</td>
                <td class="sample-data">liyPhXKB21O</td>
            </tr>
            <tr>
                <td class="column-name">url</td>
                <td>Full Madlan property page URL</td>
                <td class="sample-data">https://www.madlan.co.il/listings/liyPhXKB21O</td>
            </tr>
            <tr>
                <td class="column-name">price</td>
                <td>Property price in Israeli Shekels (â‚ª)</td>
                <td class="sample-data">3670000</td>
            </tr>
            <tr>
                <td class="column-name">rooms</td>
                <td>Number of rooms (including half rooms like 3.5, 4.5)</td>
                <td class="sample-data">5</td>
            </tr>
            <tr>
                <td class="column-name">size</td>
                <td>Property size in square meters (mÂ²)</td>
                <td class="sample-data">165</td>
            </tr>
            <tr>
                <td class="column-name">floor</td>
                <td>Floor number (negative for basement)</td>
                <td class="sample-data">3</td>
            </tr>
            <tr>
                <td class="column-name">total_floors</td>
                <td>Total floors in building</td>
                <td class="sample-data">5</td>
            </tr>
            <tr>
                <td class="column-name">price_per_sqm</td>
                <td>Price per square meter (â‚ª/mÂ²)</td>
                <td class="sample-data"><span class="null-value">NULL</span></td>
            </tr>
            <tr>
                <td class="column-name">address</td>
                <td>Street address in Hebrew</td>
                <td class="sample-data">××œ×›×¡× ×“×¨ ×™× ××™ 35</td>
            </tr>
            <tr>
                <td class="column-name">neighborhood</td>
                <td>Neighborhood name in Hebrew (e.g., ××—×•×–×”, ×›×¨××œ)</td>
                <td class="sample-data">×›×¨××œ×™×”</td>
            </tr>
            <tr>
                <td class="column-name">city</td>
                <td>City name in Hebrew (×—×™×¤×”)</td>
                <td class="sample-data">×—×™×¤×”</td>
            </tr>
            <tr>
                <td class="column-name">property_type</td>
                <td>Type: ×“×™×¨×”, ×¤× ×˜×”××•×–, ×“×™×¨×ª ×’×Ÿ, ×“×•×¤×œ×§×¡</td>
                <td class="sample-data">××“ ××“×œ×Ÿ: ×‘×§×¨×•×‘ ×œ× ×›×¡ ×–×”</td>
            </tr>
            <tr>
                <td class="column-name">has_parking</td>
                <td>TRUE if property has parking space(s)</td>
                <td class="sample-data">TRUE</td>
            </tr>
            <tr>
                <td class="column-name">has_elevator</td>
                <td>TRUE if building has elevator (××¢×œ×™×ª)</td>
                <td class="sample-data">TRUE</td>
            </tr>
            <tr>
                <td class="column-name">has_balcony</td>
                <td>TRUE if property has balcony (××¨×¤×¡×ª)</td>
                <td class="sample-data">TRUE</td>
            </tr>
            <tr>
                <td class="column-name">has_air_conditioning</td>
                <td>TRUE if has air conditioning (××–×’×Ÿ)</td>
                <td class="sample-data">TRUE</td>
            </tr>
            <tr>
                <td class="column-name">first_crawled_at</td>
                <td>Timestamp when first crawled</td>
                <td class="sample-data">Sat Oct 11 2025 11:29:40 GMT+0300 (×©×¢×•×Ÿ ×™×©×¨××œ (×§×™×¥</td>
            </tr>
            <tr>
                <td class="column-name">last_crawled_at</td>
                <td>Timestamp when last crawled</td>
                <td class="sample-data">Sat Oct 11 2025 11:29:40 GMT+0300 (×©×¢×•×Ÿ ×™×©×¨××œ (×§×™×¥</td>
            </tr>
            <tr>
                <td class="column-name">crawl_count</td>
                <td>Number of times property crawled</td>
                <td class="sample-data">1</td>
            </tr>
        </table>

        <h2>ğŸ“¸ Property Images Table</h2>
        <div class="table-comment">
            Stores image URLs and metadata for property photos, including download status and local file paths.
        </div>
        <table>
            <tr>
                <th style="width: 200px">Column</th>
                <th style="width: 400px">Description</th>
                <th>Type</th>
            </tr>
            <tr><td class="column-name">id</td><td>Auto-incrementing primary key for image records</td><td class="column-type">INTEGER</td></tr>
            <tr><td class="column-name">property_id</td><td>Foreign key to properties table</td><td class="column-type">VARCHAR</td></tr>
            <tr><td class="column-name">image_url</td><td>Full URL to image on Madlan CDN</td><td class="column-type">VARCHAR</td></tr>
            <tr><td class="column-name">image_order</td><td>Order in gallery (0 = first/main image)</td><td class="column-type">INTEGER</td></tr>
            <tr><td class="column-name">is_main_image</td><td>TRUE if primary thumbnail image</td><td class="column-type">BOOLEAN</td></tr>
            <tr><td class="column-name">is_downloaded</td><td>TRUE if downloaded to local storage</td><td class="column-type">BOOLEAN</td></tr>
            <tr><td class="column-name">local_path</td><td>Relative path to downloaded file</td><td class="column-type">VARCHAR</td></tr>
        </table>

        <h2>ğŸ“ˆ Crawl Sessions Table</h2>
        <div class="table-comment">
            Tracks crawler execution sessions with statistics and status - used for monitoring and debugging crawler runs.
        </div>
        <table>
            <tr>
                <th style="width: 200px">Column</th>
                <th style="width: 400px">Description</th>
                <th>Type</th>
            </tr>
            <tr><td class="column-name">id</td><td>Auto-incrementing primary key</td><td class="column-type">INTEGER</td></tr>
            <tr><td class="column-name">session_id</td><td>Unique session identifier (UUID or timestamp)</td><td class="column-type">VARCHAR UNIQUE</td></tr>
            <tr><td class="column-name">start_time</td><td>When crawler session started</td><td class="column-type">TIMESTAMP</td></tr>
            <tr><td class="column-name">end_time</td><td>When crawler session ended (NULL if running)</td><td class="column-type">TIMESTAMP</td></tr>
            <tr><td class="column-name">target_city</td><td>City targeted for crawl (×—×™×¤×”)</td><td class="column-type">VARCHAR</td></tr>
            <tr><td class="column-name">properties_found</td><td>Total properties discovered</td><td class="column-type">INTEGER</td></tr>
            <tr><td class="column-name">properties_new</td><td>New properties added</td><td class="column-type">INTEGER</td></tr>
            <tr><td class="column-name">properties_updated</td><td>Existing properties updated</td><td class="column-type">INTEGER</td></tr>
            <tr><td class="column-name">properties_failed</td><td>Properties that failed</td><td class="column-type">INTEGER</td></tr>
            <tr><td class="column-name">images_downloaded</td><td>Images successfully downloaded</td><td class="column-type">INTEGER</td></tr>
            <tr><td class="column-name">status</td><td>running | completed | failed | interrupted</td><td class="column-type">VARCHAR</td></tr>
        </table>

        <h2>âš ï¸ Crawl Errors Table</h2>
        <div class="table-comment">
            Logs all errors encountered during crawling for debugging and quality monitoring.
        </div>
        <table>
            <tr>
                <th style="width: 200px">Column</th>
                <th style="width: 400px">Description</th>
                <th>Type</th>
            </tr>
            <tr><td class="column-name">id</td><td>Auto-incrementing primary key</td><td class="column-type">INTEGER</td></tr>
            <tr><td class="column-name">session_id</td><td>Foreign key to crawl_sessions</td><td class="column-type">VARCHAR</td></tr>
            <tr><td class="column-name">error_type</td><td>Category: navigation/extraction/validation/network/blocking</td><td class="column-type">VARCHAR</td></tr>
            <tr><td class="column-name">error_message</td><td>Human-readable error message</td><td class="column-type">TEXT</td></tr>
            <tr><td class="column-name">error_stack</td><td>Full stack trace for debugging</td><td class="column-type">TEXT</td></tr>
            <tr><td class="column-name">url</td><td>URL where error occurred</td><td class="column-type">VARCHAR</td></tr>
            <tr><td class="column-name">property_id</td><td>Property being processed when error occurred</td><td class="column-type">VARCHAR</td></tr>
            <tr><td class="column-name">occurred_at</td><td>Timestamp when error occurred</td><td class="column-type">TIMESTAMP</td></tr>
        </table>

        <h2>ğŸ“¦ Enhanced Data Tables (Phase 5B)</h2>
        <ul>
            <li><strong>transaction_history</strong> - Historical real estate transactions for pricing trends (×—×©×•×‘ ×œ×“×¢×ª section)</li>
            <li><strong>nearby_schools</strong> - Schools near property with distance and type (×‘×ª×™ ×¡×¤×¨ section)</li>
            <li><strong>neighborhood_ratings</strong> - Community ratings 1-10 across 6 categories (×“×™×¨×•×’×™ ×”×©×›× ×™×)</li>
            <li><strong>price_comparisons</strong> - Average price data by room count for neighborhood (××—×™×¨×™ ×“×™×¨×•×ª)</li>
            <li><strong>new_construction_projects</strong> - Construction projects nearby with status (×‘× ×™×” ×—×“×©×”)</li>
        </ul>

        <h2>ğŸ¯ Production Deployment Info</h2>
        <div class="table-comment">
            <strong>Target:</strong> Haifa properties for sale<br>
            <strong>Search URL:</strong> https://www.madlan.co.il/for-sale/×—×™×¤×”-×™×©×¨××œ?tracking_search_source=new_search&marketplace=residential<br>
            <strong>Total Properties Available:</strong> ~3,600 properties<br>
            <strong>Anti-Blocking:</strong> Fresh browser per property + 60-120s delays<br>
            <strong>Success Rate:</strong> 100% validated (20-property test)<br>
            <strong>Estimated Time:</strong> ~100-160 hours for full 3,600 properties (4-7 nights)
        </div>

        <div class="metadata">
            <p><strong>Schema Version:</strong> Phase 5C - DuckDB-only architecture</p>
            <p><strong>Manual ID Generation:</strong> All tables use manual ID assignment (no sequences)</p>
            <p><strong>Total Documentation:</strong> 135+ COMMENT statements on tables and columns</p>
            <p><strong>Foreign Keys:</strong> property_images â†’ properties, crawl_errors â†’ crawl_sessions</p>
            <p><strong>Indexes:</strong> Optimized for queries by city, price, rooms, neighborhood, price_per_sqm</p>
            <p><strong>Resume Capability:</strong> Partial (updates existing properties, skips images)</p>
        </div>
    </div>
</body>
</html>